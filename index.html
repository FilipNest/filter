<html>

<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="/icons/favicon.png" rel="icon" type="icons/x-icon">

<head>

  <script src="/libraries/jquery/jquery.min.js" type="text/javascript" charset="utf-8"></script>

  <script src="/libraries/tagsinput/jquery.tagsinput.js"></script>

  <link rel="stylesheet" href="/libraries/tagsinput/jquery.tagsinput.css">

  <link rel="stylesheet" href="/style.css" />

  <title>Filters</title>

</head>

<body>

  <header>

    {{#unless req.session.user}}

    <a href="#login">Login</a> | <a href="#register">Register</a>{{else}}

    <a href="meta/logout">&#10005;</a> | <b>{{req.session.user}}</b> | <a href="@{{req.session.user}},!author={{req.session.user}}">Mentions</a> | <a href="#settings">Settings</a>{{/unless}} | <a href="https://github.com/FilipNest/filters/blob/master/readme.md">?</a>

  </header>

  {{#unless req.session.user}}
  <style>
    ul#chat {
      max-height: calc(100vh - 40px);
    }

  </style>

  <section class="form-block" id="login">

    <a class="close" href="#">Back</a>

    <form action="/meta/login" method="post">
      <h2>Sign in</h2>
      <div>
        <label>Username/email:</label>
        <input type="text" name="username" />
      </div>
      <div>
        <label>Password:</label>
        <input type="password" name="password" />
      </div>
      <div>
        <input type="submit" value="Sign In" />
      </div>
    </form>

  </section>

  <section class="form-block" id="register">

    <a class="close" href="#">Back</a>

    <form action="/meta/newUser" method="post">
      <h2>Create a new account</h2>
      <div>
        <label>Username:</label>
        <input type="text" name="username" />
      </div>
      <div>
        <label>Email:</label>
        <input type="email" name="email" />
      </div>
      <div>
        <label>Password:</label>
        <input type="password" name="password" />
      </div>
      <div>
        <input type="submit" value="Register" />
      </div>
    </form>

  </section>

  {{else}}

  <section class="form-block" id="settings">

    <a class="close" href="#">Back</a>

    <form action="/meta/userfilters" method="post">
      <h2>Settings</h2>
      <div>
        <label>Personal filters:</label>
        <p>Filters that are always applied when you're logged in, useful for blocking specific users, downvoted posts etc) only takes special filters (the ones with = in them). Comma seperated.</p>
        <textarea type="text" name="filters" placeholder="E.g minpoints=0">{{req.session.filters}}</textarea>
      </div>
      <div>
        <input type="submit" value="Submit" />
      </div>
    </form>

    <form action="/meta/userchannels" method="post">
      <div>
        <label>Channels:</label>
        <p>Insert extra URLS you want to listen to messages from. Get an Authcode from the settings page of the channel site itself once logged in there.</p>

        <button id="authCodeReveal">Reveal Authcode</button>
        <div class="authcode"></div>

        <div id="channelList">

          {{#each req.session.channels}}

          <fieldset class="channel">
            <input type="text" name="channel-number-{{@index}}" value="{{this.raw}}" placeholder="http://..." />
            <input type="password" name="channel-code-{{@index}}" value="" placeholder="{{#if this.code}} Change Authcode {{else}} Set Authcode {{/if}}" />
            <button class="removeChannel">Remove</button>
          </fieldset>

          {{/each}}
        </div>
        <button class="addChannel">Add a channel</button>
      </div>
      <div>
        <input type="submit" value="Submit" />
      </div>
    </form>

  </section>

  {{/unless}}

  <div id="tag-container">
    <input id="tags" value="{{tagsJSON}}" />
  </div>

  MESSAGES {{#if req.session.user}}


  <form id="postmessage" autocomplete="off" method="POST">

    <textarea id="words" name="words"></textarea>
    <input hidden id="tagField" name="tags" value="{{tagsJSON}}" />
    <div class="fileUpload">
      <input name="file" id="upload" type="file" class="upload" />
    </div>
    <button type="submit">Send</button>

  </form>

  <script>
    window.loggedIn = "{{req.session.user}}";

  </script>

  {{/if}} {{#if req.session.channels}}

  <script>
    window.channels = JSON.parse("{{json req.session.channels}}".split("&quot;").join('"'));

  </script>

  {{/if}}

  <script src="/filter.js"></script>

</body>

</html>
