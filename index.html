<html>

<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="/icons/favicon.png" rel="icon" type="icons/x-icon">

<head>

  <script src="/jquery/jquery.min.js" type="text/javascript" charset="utf-8"></script>

  <script src="/libraries/tagsinput/jquery.tagsinput.js"></script>

  <link rel="stylesheet" href="/libraries/tagsinput/jquery.tagsinput.css">

  <link rel="stylesheet" href="/style.css" />

  <title>Filters</title>

</head>

<body>

  <header>

    <div class="inner">

      {{#if req.session.errors}} {{#each req.session.errors}}

      <div class="error">{{this}}</div>

      {{/each}} {{/if}}

      <nav>

        {{#unless req.session.user}}


        <a id="login">Login</a> | <a id="register">Register</a> {{else}}

        <a href="meta/logout">&#10005;</a> | <b>{{req.session.user}}</b> | <a href="@{{req.session.user}},!author={{req.session.user}}">Mentions</a> | <a id="userFilters">Filters</a> | <a id="channelsMenu">Channels</a>{{/unless}} | <a href="https://github.com/FilipNest/filters/blob/master/readme.md">?</a>

      </nav>

      <div id="tagContainer">
        <input id="tags" value="{{tagsJSON}}" />
        <a id="filters" title="filters"></a>
      </div>
    </div>

  </header>

  {{#unless req.session.user}}
  <style>
    ul#chat {
      max-height: calc(100vh - 40px);
    }

  </style>

  {{else}}

    <form id="channelsForm" style="display:none;">
      <div>

        <button class="authCodeReveal">Get your authcode for this channel</button>
        <div class="authcode"></div>

        <div class="channelList">

          {{#each req.session.channels}}

          <fieldset class="channel">
            <input type="text" name="channel-number-{{@index}}" value="{{this.raw}}" placeholder="http://..." />
            <input type="password" name="channel-code-{{@index}}" value="" placeholder="{{#if this.code}} Change Authcode {{else}} Set Authcode {{/if}}" />
            <button class="removeChannel">Remove</button>
          </fieldset>

          {{/each}}
        </div>
        <button class="addChannel">Add a channel</button>
      </div>
    </form>

  {{/unless}} MESSAGES<div class="placeholder">No messages in this context yet</div>{{#if req.session.user}}

  <section id="posting">

    <form id="postmessage" autocomplete="off" method="POST">

      <textarea id="words" name="words"></textarea>
      <input hidden id="tagField" name="tags" value="{{tagsJSON}}" />
      <input type="hidden" id="fileAlt" name="fileAlt"/>
      <div class="send-icon fileUpload">
        <input name="file" id="upload" type="file" class="upload" />
      </div>
      <button class="send-icon" type="submit">Send</button>

    </form>

  </section>

  <script>
    window.loggedIn = "{{req.session.user}}";

  </script>

  {{/if}} {{#if req.session.channels}}

  <script>
    window.channels = JSON.parse("{{json req.session.channels}}".split("&quot;").join('"'));

  </script>

  {{/if}}

  <script>
    window.userFilters = "{{req.session.filters}}";

  </script>

  <script src="/filter.js"></script>
  <script src="/vex/js/vex.combined.min.js"></script>
  <link rel="stylesheet" href="/vex/css/vex.css" />
  <link rel="stylesheet" href="/vex/css/vex-theme-top.css" />
  <script src="/imagesloaded/imagesloaded.pkgd.min.js"></script>

</body>

</html>
